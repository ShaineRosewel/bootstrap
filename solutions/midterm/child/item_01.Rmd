```{r micro,results = "hide"}
source("../R/01_00_load_data.R")
```

## Bootstrap estimate of SE

Use the bootstrap to estimate the standard error of $\hat\theta = \mu_A - \mu_B$, where $\mu_A$ and $\mu_B$ are sample means of counts for methods A and B, respectively. Use $B = 2000$ bootstrap samples. Assume the replicates are **unpaired**.  

  * Let $A=X$ and $Y=B$. I am changing the labeling so as not to confuse with the number of bootstrap samples, $B$.
  * sampling is unpaired
  * Poisson distribution is assumed. Hence, this is parametric bootstrap. Recall:
  
  \begin{equation}
  \begin{aligned}
  \mathcal P(X = x \mid \lambda) = \frac{e^{-\lambda} \lambda^x}{x!}; \quad x = 0, 1, \dots; \quad 0 \leq \lambda < \infty
  \end{aligned}
  \end{equation}

  * Following the @penn (see [References]), a sufficient statistic for the parameter of the Poisson distribution, $\lambda$ is $\sum_{i = 1}^n x_i$. Since it is sufficient to know the average if we know the sum (given the sample), then we can also take the mean as another sufficient statistic.


__Algorithm:__

**Step 1**: Calculate a sufficient statistic for $\lambda_X$ (method A) and $\lambda_Y$ (method B).

\begin{equation}
\begin{aligned}
\hat \lambda_X = \frac {\sum_{i = 1}^n x_i}{n} \\
\hat \lambda_Y = \frac {\sum_{i = 1}^n y_i}{n}
\end{aligned}
\end{equation}  


**Step 2**: Let $B$ be the number of bootstrap samples taken. With $n = $`r n` and for each method, sample from the plug-in distribution.


\begin{equation}
\begin{aligned}
B^*_{Y,1} &= \left\{y_{1,1}^*, \dots, y_{1,8}^*\right\} \overset{iid}\sim \mathcal P\left(\hat \lambda_Y\right)\\
B^*_{Y,2} &= \left\{y_{2,1}^*, \dots, y_{2,8}^*\right\} \overset{iid}\sim \mathcal P\left(\hat \lambda_Y\right)\\
\vdots &= \vdots \\
B^*_{Y,2000} &= \left\{y_{2000,1}^*, \dots, y_{2000,8}^*\right\} \overset{iid}\sim \mathcal P\left(\hat \lambda_Y\right)\\
\end{aligned}
\end{equation}  


\begin{equation}
\begin{aligned}
B^*_{X,1} &= \left\{x_{1,1}^*, \dots, x_{1,8}^*\right\} \overset{iid}\sim \mathcal P\left(\hat \lambda_X\right)\\
B^*_{X,2} &= \left\{x_{2,1}^*, \dots, x_{2,8}^*\right\} \overset{iid}\sim \mathcal P\left(\hat \lambda_X\right)\\
\vdots &= \vdots \\
B^*_{X,2000} &= \left\{x_{2000,1}^*, \dots, x_{2000,8}^*\right\} \overset{iid}\sim \mathcal P\left(\hat \lambda_X\right)\\
\end{aligned}
\end{equation}  


**Step 3**: For each of the bootstrap samples, calculate $\hat\theta^*_b = \hat \mu_{X,b}^* - \hat \mu_{Y,b}^*; \quad b = 1, \dots 2000$.

**Step 4**: For each of the bootstrap samples, calculate $\hat\theta^*_b = \hat \mu_{X,b}^* - \hat \mu_{Y,b}^*; \quad b = 1, \dots 2000$.\

\begin{equation}
\begin{aligned}
\widehat {se} \left(\hat \theta\right) = \sqrt \frac{\sum_{i=1}^n \left(\hat \theta_i^*-\bar{\hat \theta}^* \right)^2}{B-1};\ \ \bar{\hat \theta}^* = \frac{1}{B}\sum^B_{i=1} \hat \theta^*_i
\end{aligned}
\end{equation}  


```{r se}
R01_01 <- "../R/01_01_se_estimate.R"
source(R01_01)
```

The bootstrap estimate of the standard error is `r suff1_se`.


## Histogram

The histogram has a symmetric bell curve shape. I recalled in class that this is expected to be centered on the statistic. In this case the statistic is `r mean(microbiology$X)-mean(microbiology$Y)` while the mean of $\hat \theta^*$'s is `r mean(suff1_theta_star)` This is the reason why I chose the mean for the plug-in distribution. If the plug-in distribution is based on the sum, the histogram will be centered on a different, larger value, far from the statistic. It will also have a higher estimate of the standard error (`r suff2_se`).

```{r echo = FALSE}
hist(
  suff1_theta_star,
  main = expression(paste("Histogram of ", hat(theta), "*")),
  xlab = expression(paste(hat(theta), "*")),
  )
```

## Confidence Intervals

```{r}
ci <- c(quantile(suff1_theta_star,.025),quantile(suff1_theta_star,.975))
```

We are $95\%$ confident that the true value of $\theta$ is between `r ci[1]` and `r ci[2]`. If instead we use sum for the sufficient statistic, then the CI will be a lot wider, with the sample statistic, not even making it within the interval `r quantile(suff2_theta_star,.025)` and `r quantile(suff2_theta_star,.975)`. 


